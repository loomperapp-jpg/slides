<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RELATORIO_EXECUTIVO_LOOMPER_MVP_V1.0_COMPLETO.md</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="📊-relatório-executivo-loomper-mvp-v1.0">📊 RELATÓRIO EXECUTIVO LOOMPER MVP v1.0</h1>
<h2 id="🎯-resumo-executivo">🎯 RESUMO EXECUTIVO</h2>
<p><strong>Documento para Desenvolvedor Profissional</strong><br>
Versão: 1.0 (Janeiro 2026)<br>
Projeto: Loomper Connect - Plataforma de Logística Automotiva<br>
Package: <code>com.loomperconnect.market</code><br>
Stack: Flutter 3.35.4 + Dart 3.9.2 + Firebase</p>
<hr>
<h2 id="📑-índice">📑 ÍNDICE</h2>
<ol>
<li><a href="#1-vis%C3%A3o-geral-do-neg%C3%B3cio">Visão Geral do Negócio</a></li>
<li><a href="#2-arquitetura-t%C3%A9cnica">Arquitetura Técnica</a></li>
<li><a href="#3-perfis-de-usu%C3%A1rio">Perfis de Usuário</a></li>
<li><a href="#4-sistema-de-cr%C3%A9ditos">Sistema de Créditos</a></li>
<li><a href="#5-pol%C3%ADtica-de-cancelamento">Política de Cancelamento</a></li>
<li><a href="#6-sistema-de-indica%C3%A7%C3%B5es-mlm">Sistema de Indicações (MLM)</a></li>
<li><a href="#7-sistema-de-gamifica%C3%A7%C3%A3o">Sistema de Gamificação</a></li>
<li><a href="#8-fluxo-de-demandas">Fluxo de Demandas</a></li>
<li><a href="#9-sistema-de-reputa%C3%A7%C3%A3o">Sistema de Reputação</a></li>
<li><a href="#10-pol%C3%ADtica-de-privacidade-lgpd">Política de Privacidade (LGPD)</a></li>
<li><a href="#11-integra%C3%A7%C3%B5es-e-apis">Integrações e APIs</a></li>
<li><a href="#12-regras-de-neg%C3%B3cio-cr%C3%ADticas">Regras de Negócio Críticas</a></li>
<li><a href="#13-roadmap-de-desenvolvimento">Roadmap de Desenvolvimento</a></li>
</ol>
<hr>
<h2 id="visão-geral-do-negócio">1. VISÃO GERAL DO NEGÓCIO</h2>
<h3 id="proposta-de-valor">1.1 Proposta de Valor</h3>
<p><strong>Loomper</strong> é uma plataforma que conecta <strong>motoristas de cegonha</strong> e <strong>transportadoras</strong> com <strong>chapas/ajudantes automotivos</strong> para serviços pontuais de:</p>
<ul>
<li>Carga e descarga de veículos</li>
<li>Guia/navegação em rotas</li>
<li>Manobras de veículos pesados</li>
<li>Conferência de documentação</li>
</ul>
<h3 id="modelo-de-negócio">1.2 Modelo de Negócio</h3>
<ul>
<li><strong>Monetização:</strong> Sistema de créditos virtuais (não é dinheiro real)</li>
<li><strong>Target:</strong> B2B2C - Motoristas profissionais e empresas de transporte</li>
<li><strong>Mercado:</strong> Nacional (fase beta em São Paulo)</li>
<li><strong>Diferencial:</strong> Sistema de reputação + gamificação + indicações MLM</li>
</ul>
<h3 id="tecnologia">1.3 Tecnologia</h3>
<pre class=" language-yaml"><code class="prism  language-yaml"><span class="token key atrule">Frontend</span><span class="token punctuation">:</span> Flutter 3.35.4 (Android/Web)
<span class="token key atrule">Backend</span><span class="token punctuation">:</span> Firebase (Firestore<span class="token punctuation">,</span> Auth<span class="token punctuation">,</span> Storage<span class="token punctuation">,</span> Messaging)
<span class="token key atrule">Linguagem</span><span class="token punctuation">:</span> Dart 3.9.2
<span class="token key atrule">Autenticação</span><span class="token punctuation">:</span> Email/Senha<span class="token punctuation">,</span> Telefone/OTP<span class="token punctuation">,</span> Google Sign<span class="token punctuation">-</span>In
<span class="token key atrule">Notificações</span><span class="token punctuation">:</span> FCM (Firebase Cloud Messaging)
</code></pre>
<hr>
<h2 id="arquitetura-técnica">2. ARQUITETURA TÉCNICA</h2>
<h3 id="estrutura-de-diretórios">2.1 Estrutura de Diretórios</h3>
<pre><code>lib/
├── core/
│   ├── constants/
│   │   ├── app_strings.dart      # Strings do app
│   │   └── enums.dart            # Enums (Status, Perfis, etc)
│   └── theme/
│       ├── app_colors.dart       # Paleta de cores
│       └── app_theme.dart        # Tema Material Design
├── data/
│   ├── models/
│   │   ├── user_model.dart       # Model do Usuário
│   │   └── demand_model.dart     # Model da Demanda
│   └── services/
│       ├── auth_service.dart            # Autenticação
│       ├── demand_service.dart          # Gerenciamento de demandas
│       ├── credits_service.dart         # Sistema de créditos
│       ├── referral_bonus_service.dart  # Indicações MLM
│       ├── gamification_service.dart    # Gamificação
│       ├── whatsapp_service.dart        # Integração WhatsApp
│       └── push_notification_service.dart # Push notifications
└── presentation/
    ├── providers/
    │   └── auth_provider.dart     # State management (Provider)
    └── screens/
        ├── auth/                  # Login/Cadastro
        ├── demands/               # Gestão de demandas
        ├── applications/          # Candidaturas
        └── profile/               # Perfil do usuário
</code></pre>
<h3 id="firestore-collections">2.2 Firestore Collections</h3>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Estrutura de dados no Firebase Firestore</span>
users<span class="token operator">/</span>                     # Usuários da plataforma
  <span class="token punctuation">{</span>userId<span class="token punctuation">}</span><span class="token operator">/</span>
    <span class="token operator">-</span> uid<span class="token punctuation">:</span> string
    <span class="token operator">-</span> name<span class="token punctuation">:</span> string
    <span class="token operator">-</span> email<span class="token punctuation">:</span> string
    <span class="token operator">-</span> phone<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> whatsapp_number<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> profile<span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">(</span>chapa<span class="token operator">|</span>motorista<span class="token operator">|</span>transportadora<span class="token punctuation">)</span>
    <span class="token operator">-</span> city<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> state<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> reputation<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token operator">-</span> total_ratings<span class="token punctuation">:</span> number
    <span class="token operator">-</span> is_active<span class="token punctuation">:</span> boolean
    <span class="token operator">-</span> work_radius<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span>km<span class="token punctuation">)</span>
    <span class="token operator">-</span> is_available<span class="token punctuation">:</span> boolean
    <span class="token operator">-</span> last_access<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> streak<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span>dias consecutivos<span class="token punctuation">)</span>
    <span class="token operator">-</span> best_streak<span class="token punctuation">:</span> number
    <span class="token operator">-</span> created_at<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> updated_at<span class="token punctuation">:</span> timestamp
    
    <span class="token comment">// Subcollection: Carteira de Créditos</span>
    <span class="token operator">/</span>wallets<span class="token operator">/</span><span class="token punctuation">{</span>walletId<span class="token punctuation">}</span>
      <span class="token operator">-</span> user_id<span class="token punctuation">:</span> string
      <span class="token operator">-</span> balance<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span>créditos disponíveis<span class="token punctuation">)</span>
      <span class="token operator">-</span> reserved_balance<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span>créditos reservados<span class="token punctuation">)</span>
      <span class="token operator">-</span> total_earned<span class="token punctuation">:</span> number
      <span class="token operator">-</span> total_spent<span class="token punctuation">:</span> number
      <span class="token operator">-</span> last_renewal_date<span class="token punctuation">:</span> <span class="token function">timestamp</span> <span class="token punctuation">(</span>dia <span class="token number">1</span> <span class="token keyword">do</span> mês<span class="token punctuation">)</span>
      
    <span class="token comment">// Subcollection: Transações de Créditos</span>
    <span class="token operator">/</span>credit_transactions<span class="token operator">/</span><span class="token punctuation">{</span>transactionId<span class="token punctuation">}</span>
      <span class="token operator">-</span> user_id<span class="token punctuation">:</span> string
      <span class="token operator">-</span> type<span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">(</span>addition<span class="token operator">|</span>deduction<span class="token punctuation">)</span>
      <span class="token operator">-</span> amount<span class="token punctuation">:</span> number
      <span class="token operator">-</span> description<span class="token punctuation">:</span> string
      <span class="token operator">-</span> related_id<span class="token punctuation">:</span> string<span class="token operator">?</span> <span class="token punctuation">(</span>ID da demanda<span class="token operator">/</span>indicação<span class="token punctuation">)</span>
      <span class="token operator">-</span> created_at<span class="token punctuation">:</span> timestamp
      
    <span class="token comment">// Subcollection: Conquistas</span>
    <span class="token operator">/</span>achievements<span class="token operator">/</span><span class="token punctuation">{</span>achievementId<span class="token punctuation">}</span>
      <span class="token operator">-</span> achievement_id<span class="token punctuation">:</span> string
      <span class="token operator">-</span> name<span class="token punctuation">:</span> string
      <span class="token operator">-</span> description<span class="token punctuation">:</span> string
      <span class="token operator">-</span> icon<span class="token punctuation">:</span> <span class="token function">string</span> <span class="token punctuation">(</span>emoji<span class="token punctuation">)</span>
      <span class="token operator">-</span> bonus<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span>créditos<span class="token punctuation">)</span>
      <span class="token operator">-</span> unlocked_at<span class="token punctuation">:</span> timestamp

demands<span class="token operator">/</span>                   # Demandas criadas por motoristas
  <span class="token punctuation">{</span>demandId<span class="token punctuation">}</span><span class="token operator">/</span>
    <span class="token operator">-</span> id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> created_by<span class="token punctuation">:</span> <span class="token function">string</span> <span class="token punctuation">(</span>userId <span class="token keyword">do</span> motorista<span class="token punctuation">)</span>
    <span class="token operator">-</span> title<span class="token punctuation">:</span> string
    <span class="token operator">-</span> description<span class="token punctuation">:</span> string
    <span class="token operator">-</span> location<span class="token punctuation">:</span> string
    <span class="token operator">-</span> city<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> state<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> scheduled_date<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> scheduled_time<span class="token punctuation">:</span> <span class="token function">string</span> <span class="token punctuation">(</span>HH<span class="token punctuation">:</span>mm<span class="token punctuation">)</span>
    <span class="token operator">-</span> support_type<span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">(</span>guia<span class="token operator">|</span>carga<span class="token operator">|</span>descarga<span class="token operator">|</span>cargaDescarga<span class="token operator">|</span>manobra<span class="token operator">|</span>conferencia<span class="token punctuation">)</span>
    <span class="token operator">-</span> offered_value<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span>créditos<span class="token punctuation">)</span>
    <span class="token operator">-</span> status<span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">(</span>open<span class="token operator">|</span>pendingSelection<span class="token operator">|</span>matched<span class="token operator">|</span>inProgress<span class="token operator">|</span>completed<span class="token operator">|</span>cancelled<span class="token punctuation">)</span>
    <span class="token operator">-</span> invited_favorites<span class="token punctuation">:</span> array<span class="token operator">&lt;</span>string<span class="token operator">&gt;</span> <span class="token punctuation">(</span>IDs dos chapas convidados<span class="token punctuation">)</span>
    <span class="token operator">-</span> selected_chapa_id<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> service_code<span class="token punctuation">:</span> string<span class="token operator">?</span> <span class="token punctuation">(</span>MMMM<span class="token operator">-</span>CCCC formato completo<span class="token punctuation">)</span>
    <span class="token operator">-</span> motorista_code<span class="token punctuation">:</span> string<span class="token operator">?</span> <span class="token punctuation">(</span><span class="token number">4</span> dígitos<span class="token punctuation">)</span>
    <span class="token operator">-</span> chapa_code<span class="token punctuation">:</span> string<span class="token operator">?</span> <span class="token punctuation">(</span><span class="token number">4</span> dígitos<span class="token punctuation">)</span>
    <span class="token operator">-</span> reserved_amount<span class="token punctuation">:</span> number<span class="token operator">?</span>
    <span class="token operator">-</span> transaction_id<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> created_at<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> updated_at<span class="token punctuation">:</span> timestamp

applications<span class="token operator">/</span>              # Candidaturas de chapas para demandas
  <span class="token punctuation">{</span>applicationId<span class="token punctuation">}</span><span class="token operator">/</span>
    <span class="token operator">-</span> id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> demand_id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> chapa_id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> chapa_name<span class="token punctuation">:</span> string
    <span class="token operator">-</span> chapa_photo<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> chapa_reputation<span class="token punctuation">:</span> number
    <span class="token operator">-</span> status<span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">(</span>pending<span class="token operator">|</span>accepted<span class="token operator">|</span>rejected<span class="token operator">|</span>expired<span class="token punctuation">)</span>
    <span class="token operator">-</span> applied_at<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> updated_at<span class="token punctuation">:</span> timestamp

services<span class="token operator">/</span>                  # Serviços em andamento<span class="token operator">/</span>concluídos
  <span class="token punctuation">{</span>serviceId<span class="token punctuation">}</span><span class="token operator">/</span>
    <span class="token operator">-</span> id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> demand_id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> motorista_id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> chapa_id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> service_code<span class="token punctuation">:</span> <span class="token function">string</span> <span class="token punctuation">(</span>MMMM<span class="token operator">-</span>CCCC<span class="token punctuation">)</span>
    <span class="token operator">-</span> status<span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">(</span>scheduled<span class="token operator">|</span>inProgress<span class="token operator">|</span>completed<span class="token operator">|</span>cancelled<span class="token operator">|</span>noShow<span class="token punctuation">)</span>
    <span class="token operator">-</span> scheduled_date<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> started_at<span class="token punctuation">:</span> timestamp<span class="token operator">?</span>
    <span class="token operator">-</span> completed_at<span class="token punctuation">:</span> timestamp<span class="token operator">?</span>
    <span class="token operator">-</span> motorista_rating<span class="token punctuation">:</span> number<span class="token operator">?</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token operator">-</span> motorista_review<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> chapa_rating<span class="token punctuation">:</span> number<span class="token operator">?</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token operator">-</span> chapa_review<span class="token punctuation">:</span> string<span class="token operator">?</span>
    <span class="token operator">-</span> created_at<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> updated_at<span class="token punctuation">:</span> timestamp

referrals<span class="token operator">/</span>                 # Sistema de indicações MLM
  <span class="token punctuation">{</span>referralId<span class="token punctuation">}</span><span class="token operator">/</span>
    <span class="token operator">-</span> referral_id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> referrer_id<span class="token punctuation">:</span> <span class="token function">string</span> <span class="token punctuation">(</span>quem indicou<span class="token punctuation">)</span>
    <span class="token operator">-</span> referred_id<span class="token punctuation">:</span> <span class="token function">string</span> <span class="token punctuation">(</span>quem foi indicado<span class="token punctuation">)</span>
    <span class="token operator">-</span> referred_name<span class="token punctuation">:</span> string
    <span class="token operator">-</span> status<span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">(</span>invited<span class="token operator">|</span>registered<span class="token operator">|</span>active<span class="token operator">|</span>active_level_2<span class="token punctuation">)</span>
    <span class="token operator">-</span> level<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">=</span>direto<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">=</span>indireto<span class="token punctuation">)</span>
    <span class="token operator">-</span> bonuses_earned<span class="token punctuation">:</span> object <span class="token punctuation">{</span>
        invited<span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>
        registered<span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>
        used_app<span class="token punctuation">:</span> boolean<span class="token punctuation">,</span>
        level_2<span class="token punctuation">:</span> boolean
      <span class="token punctuation">}</span>
    <span class="token operator">-</span> created_at<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> updated_at<span class="token punctuation">:</span> timestamp

cancellations<span class="token operator">/</span>             # Histórico de cancelamentos
  <span class="token punctuation">{</span>cancellationId<span class="token punctuation">}</span><span class="token operator">/</span>
    <span class="token operator">-</span> id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> demand_id<span class="token punctuation">:</span> string
    <span class="token operator">-</span> cancelled_by<span class="token punctuation">:</span> <span class="token function">string</span> <span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
    <span class="token operator">-</span> cancelled_role<span class="token punctuation">:</span> <span class="token keyword">enum</span> <span class="token punctuation">(</span>motorista<span class="token operator">|</span>chapa<span class="token punctuation">)</span>
    <span class="token operator">-</span> reason<span class="token punctuation">:</span> string
    <span class="token operator">-</span> cancellation_date<span class="token punctuation">:</span> timestamp
    <span class="token operator">-</span> hours_before_service<span class="token punctuation">:</span> number
    <span class="token operator">-</span> refund_amount<span class="token punctuation">:</span> number
    <span class="token operator">-</span> tax_rate<span class="token punctuation">:</span> <span class="token function">number</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">)</span>
    <span class="token operator">-</span> tax_description<span class="token punctuation">:</span> string
    <span class="token operator">-</span> created_at<span class="token punctuation">:</span> timestamp
</code></pre>
<hr>
<h2 id="perfis-de-usuário">3. PERFIS DE USUÁRIO</h2>
<h3 id="tipos-de-perfil">3.1 Tipos de Perfil</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">enum</span> UserProfile <span class="token punctuation">{</span>
  chapa<span class="token punctuation">,</span>           <span class="token comment">// Chapa/Ajudante automotivo</span>
  motorista<span class="token punctuation">,</span>       <span class="token comment">// Motorista de cegonha</span>
  transportadora   <span class="token comment">// Empresa de transporte</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="funcionalidades-por-perfil">3.2 Funcionalidades por Perfil</h3>
<h4 id="chapa-prestador-de-serviço"><strong>CHAPA (Prestador de Serviço)</strong></h4>
<ul>
<li>✅ Receber notificações de demandas próximas (raio configurável)</li>
<li>✅ Candidatar-se para demandas públicas</li>
<li>✅ Aceitar convites de motoristas favoritos</li>
<li>✅ Configurar disponibilidade (online/offline)</li>
<li>✅ Receber pagamento em créditos após serviço</li>
<li>✅ Avaliar motoristas (1-5 estrelas)</li>
<li>✅ Sistema de reputação baseado em avaliações</li>
<li>✅ Histórico de serviços realizados</li>
</ul>
<h4 id="motorista-tomador-de-serviço"><strong>MOTORISTA (Tomador de Serviço)</strong></h4>
<ul>
<li>✅ Criar demandas de serviço (custa 50 créditos)</li>
<li>✅ Convidar chapas favoritos (grátis, até 3 por demanda)</li>
<li>✅ Ver candidatos da demanda</li>
<li>✅ Aceitar chapa (custa 150 créditos)</li>
<li>✅ Gerar código de serviço (MMMM-CCCC)</li>
<li>✅ Validar código do chapa (CCCC)</li>
<li>✅ Iniciar serviço com código validado</li>
<li>✅ Finalizar serviço e liberar pagamento</li>
<li>✅ Avaliar chapa (1-5 estrelas)</li>
<li>✅ Cancelar match (com taxa progressiva)</li>
<li>✅ Adicionar chapas aos favoritos</li>
</ul>
<h4 id="transportadora-gestão-de-frota"><strong>TRANSPORTADORA (Gestão de Frota)</strong></h4>
<ul>
<li>✅ Criar demandas em nome de motoristas</li>
<li>✅ Gerenciar múltiplos motoristas</li>
<li>✅ Contratar pacotes de créditos</li>
<li>✅ Relatórios de uso de créditos</li>
<li>📌 <em>Funcionalidade em desenvolvimento</em></li>
</ul>
<hr>
<h2 id="sistema-de-créditos">4. SISTEMA DE CRÉDITOS</h2>
<h3 id="o-que-são-créditos">4.1 O que são Créditos?</h3>
<p><strong>Créditos são a moeda virtual interna do Loomper.</strong><br>
⚠️ <strong>IMPORTANTE:</strong> Créditos <strong>NÃO são dinheiro real</strong> e <strong>NÃO podem ser convertidos em reais</strong>.</p>
<h3 id="obtenção-de-créditos">4.2 Obtenção de Créditos</h3>
<h4 id="recarga-mensal-automática"><strong>Recarga Mensal Automática</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Renovação dia 1 de cada mês</span>
<span class="token keyword">const</span> int monthlyCredits <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>  <span class="token comment">// 1.000 créditos</span>
</code></pre>
<ul>
<li><strong>Quando:</strong> Todo dia 1º do mês às 00:00</li>
<li><strong>Quantidade:</strong> 1.000 créditos</li>
<li><strong>Acumulação:</strong> ❌ NÃO acumula (reseta para 1.000)</li>
<li><strong>Perfis:</strong> Todos os perfis (chapa, motorista, transportadora)</li>
</ul>
<h4 id="bônus-de-indicação-mlm"><strong>Bônus de Indicação (MLM)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Sistema de Marketing Multinível</span>
<span class="token keyword">const</span> int bonusReferralInvited <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>      <span class="token comment">// +50 créditos (indicou alguém)</span>
<span class="token keyword">const</span> int bonusReferralRegistered <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>  <span class="token comment">// +100 créditos (indicado se cadastrou)</span>
<span class="token keyword">const</span> int bonusReferralUsedApp <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>     <span class="token comment">// +150 créditos (indicado usou o app)</span>
<span class="token keyword">const</span> int bonusReferralLevel2 <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>      <span class="token comment">// +200 créditos (indicado indicou outro)</span>
<span class="token keyword">const</span> int bonusMonthlyLimit <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>        <span class="token comment">// Máximo 500 créditos/mês de bônus</span>
</code></pre>
<p><strong>Fluxo de Indicação:</strong></p>
<ol>
<li><strong>Usuário A indica Usuário B</strong> → A ganha +50 créditos</li>
<li><strong>Usuário B se cadastra</strong> → A ganha +100 créditos</li>
<li><strong>Usuário B usa o app (cria demanda ou candidatura)</strong> → A ganha +150 créditos</li>
<li><strong>Usuário B indica Usuário C</strong> → A ganha +200 créditos (MLM nível 2)</li>
</ol>
<p>⚠️ <strong>Teto de Segurança:</strong> Máximo de 500 créditos/mês em bônus de indicação (anti-fraude)</p>
<h4 id="bônus-de-gamificação"><strong>Bônus de Gamificação</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Conquistas que dão bônus de créditos</span>
achievements <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'first_demand'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">100</span> créditos<span class="token punctuation">,</span>        <span class="token comment">// Primeira demanda criada</span>
  <span class="token string">'first_match'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">50</span> créditos<span class="token punctuation">,</span>          <span class="token comment">// Primeiro match aceito</span>
  <span class="token string">'first_5_stars'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">75</span> créditos<span class="token punctuation">,</span>        <span class="token comment">// Primeira avaliação 5 estrelas</span>
  <span class="token string">'streak_7_days'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">100</span> créditos<span class="token punctuation">,</span>       <span class="token comment">// 7 dias consecutivos usando o app</span>
  <span class="token string">'streak_30_days'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">500</span> créditos<span class="token punctuation">,</span>      <span class="token comment">// 30 dias consecutivos</span>
  <span class="token string">'challenge_5_matches'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">200</span> créditos<span class="token punctuation">,</span> <span class="token comment">// 5 matches em 1 mês</span>
  <span class="token string">'challenge_3_referrals'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">300</span> créditos<span class="token punctuation">,</span> <span class="token comment">// 3 indicações ativas em 1 mês</span>
  <span class="token string">'milestone_10_demands'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">250</span> créditos<span class="token punctuation">,</span> <span class="token comment">// 10 demandas criadas</span>
  <span class="token string">'milestone_50_matches'</span><span class="token punctuation">:</span> <span class="token operator">+</span><span class="token number">1000</span> créditos <span class="token comment">// 50 matches completos</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="consumo-de-créditos">4.3 Consumo de Créditos</h3>
<h4 id="custos-para-motoristas"><strong>Custos para Motoristas</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">const</span> int demandCreationCost <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>    <span class="token comment">// Criar demanda: -50 créditos</span>
<span class="token keyword">const</span> int matchAcceptedCost <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>    <span class="token comment">// Aceitar chapa: -150 créditos (reservado)</span>
</code></pre>
<p><strong>Fluxo de Pagamento:</strong></p>
<ol>
<li><strong>Criar demanda:</strong> -50 créditos (debitado imediatamente)</li>
<li><strong>Aceitar chapa:</strong> -150 créditos (RESERVADOS, não debitados)</li>
<li><strong>Chapa confirma código:</strong> Créditos continuam reservados</li>
<li><strong>Serviço concluído:</strong> -150 créditos (pagamento liberado para o chapa)</li>
<li><strong>Cancelamento:</strong> Reembolso parcial conforme política</li>
</ol>
<h4 id="custos-para-chapas"><strong>Custos para Chapas</strong></h4>
<ul>
<li>✅ <strong>Grátis:</strong> Candidatar-se para demandas</li>
<li>✅ <strong>Grátis:</strong> Aceitar convites de favoritos</li>
<li>✅ <strong>Grátis:</strong> Uso geral do app</li>
</ul>
<h3 id="wallet-carteira">4.4 Wallet (Carteira)</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">class</span> <span class="token class-name">Wallet</span> <span class="token punctuation">{</span>
  int balance<span class="token punctuation">;</span>          <span class="token comment">// Saldo disponível</span>
  int reservedBalance<span class="token punctuation">;</span>  <span class="token comment">// Créditos reservados (em matches ativos)</span>
  int totalEarned<span class="token punctuation">;</span>      <span class="token comment">// Total ganho (histórico)</span>
  int totalSpent<span class="token punctuation">;</span>       <span class="token comment">// Total gasto (histórico)</span>
  DateTime lastRenewalDate<span class="token punctuation">;</span> <span class="token comment">// Última renovação mensal</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Exemplo de Extrato:</strong></p>
<pre><code>Saldo Disponível: 850 créditos
Créditos Reservados: 150 créditos (1 match ativo)
Saldo Total: 1.000 créditos

Histórico:
+ 1000 créditos - 💰 Renovação mensal (01/01/2026)
-   50 créditos - 📝 Demanda criada: Carga em SP (03/01/2026)
- 150 créditos - 🤝 Match aceito: João Silva (03/01/2026, reservado)
</code></pre>
<hr>
<h2 id="política-de-cancelamento">5. POLÍTICA DE CANCELAMENTO</h2>
<h3 id="quem-pode-cancelar">5.1 Quem Pode Cancelar?</h3>
<ul>
<li>✅ <strong>Motorista:</strong> Pode cancelar o match após aceitar o chapa</li>
<li>✅ <strong>Chapa:</strong> Pode cancelar candidatura antes de ser aceito (sem penalidade)</li>
<li>❌ <strong>Chapa:</strong> NÃO pode cancelar após match confirmado (precisa contatar suporte)</li>
</ul>
<h3 id="tabela-de-reembolso-motorista">5.2 Tabela de Reembolso (Motorista)</h3>

<table>
<thead>
<tr>
<th>Motivo do Cancelamento</th>
<th>Prazo até Serviço</th>
<th>Taxa</th>
<th>Reembolso</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Força Maior</strong></td>
<td>Qualquer</td>
<td>0%</td>
<td>150 créditos</td>
<td>Emergência médica, acidente, evento climático (requer comprovante posterior)</td>
</tr>
<tr>
<td><strong>Outro Motivo</strong></td>
<td>Mais de 24h</td>
<td>20%</td>
<td>120 créditos</td>
<td>Cancelamento com antecedência razoável</td>
</tr>
<tr>
<td><strong>Outro Motivo</strong></td>
<td>12h a 24h</td>
<td>50%</td>
<td>75 créditos</td>
<td>Cancelamento em cima da hora</td>
</tr>
<tr>
<td><strong>Outro Motivo</strong></td>
<td>Menos de 12h</td>
<td>100%</td>
<td>0 créditos</td>
<td>Cancelamento de última hora (sem reembolso)</td>
</tr>
<tr>
<td><strong>Substituição por Outro Chapa</strong></td>
<td>Qualquer</td>
<td>100%</td>
<td>0 créditos</td>
<td>Cancelou para contratar outro chapa (sem reembolso)</td>
</tr>
</tbody>
</table><h3 id="motivos-de-cancelamento">5.3 Motivos de Cancelamento</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">enum</span> CancellationReason <span class="token punctuation">{</span>
  forca_maior<span class="token punctuation">,</span>        <span class="token comment">// Força maior (emergência, doença, acidente)</span>
  chapa_nao_apareceu<span class="token punctuation">,</span> <span class="token comment">// Chapa não apareceu no local</span>
  mudanca_planos<span class="token punctuation">,</span>     <span class="token comment">// Mudança de planos (outros motivos)</span>
  outro_chapa<span class="token punctuation">,</span>        <span class="token comment">// Encontrou outro chapa (sem reembolso)</span>
  outros              <span class="token comment">// Outros motivos</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="fluxo-de-cancelamento-backend">5.4 Fluxo de Cancelamento (Backend)</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Código simplificado do serviço de cancelamento</span>
Future<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token function">cancelMatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  required String applicationId<span class="token punctuation">,</span>
  required String reason<span class="token punctuation">,</span>
  required String detailedReason<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Buscar dados da aplicação</span>
  <span class="token keyword">final</span> application <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getApplication</span><span class="token punctuation">(</span>applicationId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 2. Calcular tempo até o serviço</span>
  <span class="token keyword">final</span> hoursUntilService <span class="token operator">=</span> <span class="token function">calculateHoursUntilService</span><span class="token punctuation">(</span>application<span class="token punctuation">.</span>scheduledDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 3. Calcular reembolso conforme tabela</span>
  int refundAmount <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span> <span class="token comment">// Valor padrão</span>
  double taxRate <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
  String taxDescription <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> <span class="token string">'outro_chapa'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Sem reembolso: cancelou para contratar outro</span>
    refundAmount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    taxRate <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
    taxDescription <span class="token operator">=</span> <span class="token string">'🚫 Cancelamento para outro serviço: Taxa 100%'</span><span class="token punctuation">;</span>
    
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">==</span> <span class="token string">'forca_maior'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Reembolso total: força maior (requer comprovante)</span>
    refundAmount <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>
    taxRate <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    taxDescription <span class="token operator">=</span> <span class="token string">'✅ Força maior: Reembolso total (aguardando comprovante)'</span><span class="token punctuation">;</span>
    
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Outros motivos: taxa baseada no tempo</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hoursUntilService <span class="token operator">&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      taxRate <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span> <span class="token comment">// Taxa 20%</span>
      refundAmount <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span>
      taxDescription <span class="token operator">=</span> <span class="token string">'⏰ Cancelamento com +24h: Taxa 20%'</span><span class="token punctuation">;</span>
      
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>hoursUntilService <span class="token operator">&gt;</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      taxRate <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span> <span class="token comment">// Taxa 50%</span>
      refundAmount <span class="token operator">=</span> <span class="token number">75</span><span class="token punctuation">;</span>
      taxDescription <span class="token operator">=</span> <span class="token string">'⏰ Cancelamento 12-24h antes: Taxa 50%'</span><span class="token punctuation">;</span>
      
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      taxRate <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span> <span class="token comment">// Taxa 100%</span>
      refundAmount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      taxDescription <span class="token operator">=</span> <span class="token string">'🚫 Cancelamento &lt;12h: Taxa 100%'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 4. Liberar créditos reservados (reembolso)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>refundAmount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> creditsService<span class="token punctuation">.</span><span class="token function">addCredits</span><span class="token punctuation">(</span>
      motoristaId<span class="token punctuation">,</span>
      refundAmount<span class="token punctuation">,</span>
      <span class="token string">'♻️ Reembolso: Match cancelado (+$refundAmount créditos) - $taxDescription'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 5. Registrar cancelamento no histórico</span>
  <span class="token keyword">await</span> <span class="token function">saveCancellationHistory</span><span class="token punctuation">(</span>applicationId<span class="token punctuation">,</span> reason<span class="token punctuation">,</span> refundAmount<span class="token punctuation">,</span> taxRate<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 6. Atualizar status da demanda (volta para "open")</span>
  <span class="token keyword">await</span> <span class="token function">updateDemandStatus</span><span class="token punctuation">(</span>demandId<span class="token punctuation">,</span> DemandStatus<span class="token punctuation">.</span>open<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 7. Notificar chapa por WhatsApp</span>
  <span class="token keyword">await</span> whatsappService<span class="token punctuation">.</span><span class="token function">notifyCancellation</span><span class="token punctuation">(</span>chapaId<span class="token punctuation">,</span> demandTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="registro-de-cancelamentos">5.5 Registro de Cancelamentos</h3>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Firestore: cancellations/{cancellationId}</span>
<span class="token punctuation">{</span>
  <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string">"cancel_123"</span><span class="token punctuation">,</span>
  <span class="token string">"demand_id"</span><span class="token punctuation">:</span> <span class="token string">"demand_456"</span><span class="token punctuation">,</span>
  <span class="token string">"application_id"</span><span class="token punctuation">:</span> <span class="token string">"app_789"</span><span class="token punctuation">,</span>
  <span class="token string">"cancelled_by"</span><span class="token punctuation">:</span> <span class="token string">"motorista_user_id"</span><span class="token punctuation">,</span>
  <span class="token string">"cancelled_role"</span><span class="token punctuation">:</span> <span class="token string">"motorista"</span><span class="token punctuation">,</span>
  <span class="token string">"reason"</span><span class="token punctuation">:</span> <span class="token string">"mudanca_planos"</span><span class="token punctuation">,</span>
  <span class="token string">"detailed_reason"</span><span class="token punctuation">:</span> <span class="token string">"Viagem foi cancelada pela transportadora"</span><span class="token punctuation">,</span>
  <span class="token string">"cancellation_date"</span><span class="token punctuation">:</span> <span class="token string">"2026-01-15T10:30:00Z"</span><span class="token punctuation">,</span>
  <span class="token string">"scheduled_date"</span><span class="token punctuation">:</span> <span class="token string">"2026-01-16T08:00:00Z"</span><span class="token punctuation">,</span>
  <span class="token string">"hours_before_service"</span><span class="token punctuation">:</span> <span class="token number">21.5</span><span class="token punctuation">,</span>
  <span class="token string">"refund_amount"</span><span class="token punctuation">:</span> <span class="token number">120</span><span class="token punctuation">,</span>
  <span class="token string">"tax_rate"</span><span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
  <span class="token string">"tax_description"</span><span class="token punctuation">:</span> <span class="token string">"⏰ Cancelamento com +24h: Taxa 20%"</span><span class="token punctuation">,</span>
  <span class="token string">"created_at"</span><span class="token punctuation">:</span> <span class="token string">"2026-01-15T10:30:00Z"</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="sistema-de-indicações-mlm">6. SISTEMA DE INDICAÇÕES (MLM)</h2>
<h3 id="estrutura-do-mlm">6.1 Estrutura do MLM</h3>
<pre><code>Nível 1 (Direto):
  Usuário A indica Usuário B
  → Bônus: +50 (indicou) +100 (cadastrou) +150 (usou) = +300 créditos

Nível 2 (Indireto):
  Usuário B indica Usuário C
  → Usuário A ganha +200 créditos (MLM nível 2)
</code></pre>
<h3 id="fases-da-indicação">6.2 Fases da Indicação</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">enum</span> ReferralStatus <span class="token punctuation">{</span>
  invited<span class="token punctuation">,</span>         <span class="token comment">// Link enviado, aguardando cadastro</span>
  registered<span class="token punctuation">,</span>      <span class="token comment">// Indicado se cadastrou</span>
  active<span class="token punctuation">,</span>          <span class="token comment">// Indicado usou o app (criou demanda ou candidatura)</span>
  active_level_2   <span class="token comment">// Indicado de nível 2 ativo</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="bônus-de-indicação-detalhado">6.3 Bônus de Indicação Detalhado</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Fase 1: Indicou alguém (enviou link)</span>
<span class="token function">processNewReferral</span><span class="token punctuation">(</span>referrerId<span class="token punctuation">,</span> referredId<span class="token punctuation">,</span> referredName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// +50 créditos imediatamente</span>
  <span class="token function">addCredits</span><span class="token punctuation">(</span>referrerId<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">'🎁 Bônus: Indicou ${referredName}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fase 2: Indicado se cadastrou</span>
<span class="token function">markReferralAsRegistered</span><span class="token punctuation">(</span>referredId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// +100 créditos quando indicado completa cadastro</span>
  <span class="token function">addCredits</span><span class="token punctuation">(</span>referrerId<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'🎁 Bônus: ${referredName} se cadastrou!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fase 3: Indicado usou o app</span>
<span class="token function">markReferralAsActive</span><span class="token punctuation">(</span>referredId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// +150 créditos quando indicado cria demanda ou candidatura</span>
  <span class="token function">addCredits</span><span class="token punctuation">(</span>referrerId<span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token string">'🎁 Bônus: ${referredName} usou o app!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fase 4: Indicado indicou outro (MLM nível 2)</span>
<span class="token function">processLevel2Referral</span><span class="token punctuation">(</span>level1ReferrerId<span class="token punctuation">,</span> level2ReferredId<span class="token punctuation">,</span> level2Name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// +200 créditos quando indicado do usuário indica outra pessoa</span>
  <span class="token function">addCredits</span><span class="token punctuation">(</span>level1ReferrerId<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">'🎁 Bônus MLM: Sua indicação indicou ${level2Name}!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="teto-mensal-de-bônus">6.4 Teto Mensal de Bônus</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">const</span> int bonusMonthlyLimit <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span> <span class="token comment">// Máximo 500 créditos/mês</span>

<span class="token comment">// Exemplo: Usuário A indicou 3 pessoas este mês</span>
<span class="token comment">// Indicação 1: +50 +100 +150 = +300 créditos ✅</span>
<span class="token comment">// Indicação 2: +50 +100 +50 = +200 créditos ✅ (atingiu o teto)</span>
<span class="token comment">// Indicação 3: +0 créditos ❌ (teto mensal excedido)</span>
</code></pre>
<p><strong>Objetivo do Teto:</strong> Prevenir fraudes e abuso do sistema de indicações.</p>
<h3 id="link-de-indicação">6.5 Link de Indicação</h3>
<pre class=" language-dart"><code class="prism  language-dart">String <span class="token function">generateReferralLink</span><span class="token punctuation">(</span>String userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'https://app.loomper.com/register?ref=$userId'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>Fluxo Completo:</strong></p>
<ol>
<li>Usuário A compartilha link: <code>https://app.loomper.com/register?ref=userA123</code></li>
<li>Usuário B clica no link e se cadastra</li>
<li>Sistema detecta <code>ref=userA123</code> e cria registro de indicação</li>
<li>Sistema processa bônus conforme fases acima</li>
</ol>
<hr>
<h2 id="sistema-de-gamificação">7. SISTEMA DE GAMIFICAÇÃO</h2>
<h3 id="objetivos">7.1 Objetivos</h3>
<ul>
<li>🎯 Aumentar engajamento e retenção</li>
<li>🏆 Recompensar usuários ativos</li>
<li>🔥 Criar hábito de uso diário</li>
<li>💎 Reconhecimento por marcos alcançados</li>
</ul>
<h3 id="conquistas-disponíveis">7.2 Conquistas Disponíveis</h3>
<h4 id="conquistas-de-primeira-vez"><strong>Conquistas de Primeira Vez</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token punctuation">{</span>
  <span class="token string">'first_demand'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Primeira Demanda'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Crie sua primeira demanda'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'📝'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFF4CAF50'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'first_match'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Primeiro Match'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Aceite seu primeiro chapa'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'🤝'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFF2196F3'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'first_5_stars'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Primeira Avaliação 5 Estrelas'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Receba sua primeira avaliação 5 estrelas'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'⭐'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">75</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFFFFD700'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="conquistas-de-streak-uso-diário"><strong>Conquistas de Streak (Uso Diário)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token punctuation">{</span>
  <span class="token string">'streak_7_days'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Usuário Dedicado'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Use o app por 7 dias consecutivos'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'🔥'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFFFF5722'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'streak_30_days'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Usuário VIP'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Use o app por 30 dias consecutivos'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'💎'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFF9C27B0'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="desafios-mensais"><strong>Desafios Mensais</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token punctuation">{</span>
  <span class="token string">'challenge_5_matches'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Desafio: 5 Matches'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Faça 5 matches em um mês'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'🎯'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFFFF9800'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'challenge_3_referrals'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Desafio: 3 Indicações'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Indique 3 amigos que usem o app'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'🚀'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFF00BCD4'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="marcos-de-experiência"><strong>Marcos de Experiência</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token punctuation">{</span>
  <span class="token string">'milestone_10_demands'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Criador de Demandas'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Crie 10 demandas'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'📈'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFF673AB7'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">'milestone_50_matches'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Profissional'</span><span class="token punctuation">,</span>
    <span class="token string">'description'</span><span class="token punctuation">:</span> <span class="token string">'Complete 50 matches'</span><span class="token punctuation">,</span>
    <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'🏆'</span><span class="token punctuation">,</span>
    <span class="token string">'bonus'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token string">'badge_color'</span><span class="token punctuation">:</span> <span class="token string">'0xFFD4AF37'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="sistema-de-streak">7.3 Sistema de Streak</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Armazenado no documento do usuário</span>
<span class="token punctuation">{</span>
  <span class="token string">"last_access"</span><span class="token punctuation">:</span> <span class="token string">"2026-01-21T10:00:00Z"</span><span class="token punctuation">,</span>
  <span class="token string">"streak"</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>          <span class="token comment">// Dias consecutivos atuais</span>
  <span class="token string">"best_streak"</span><span class="token punctuation">:</span> <span class="token number">15</span>     <span class="token comment">// Maior streak já alcançado</span>
<span class="token punctuation">}</span>

<span class="token comment">// Lógica de atualização diária</span>
<span class="token function">updateDailyStreak</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. Verificar último acesso</span>
  <span class="token keyword">final</span> lastAccess <span class="token operator">=</span> user<span class="token punctuation">.</span>lastAccess<span class="token punctuation">;</span>
  <span class="token keyword">final</span> today <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 2. Calcular streak</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>lastAccess <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Primeiro acesso</span>
    streak <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameDay</span><span class="token punctuation">(</span>lastAccess<span class="token punctuation">,</span> today<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Já acessou hoje, não fazer nada</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isYesterday</span><span class="token punctuation">(</span>lastAccess<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Acesso consecutivo: +1 dia</span>
    streak<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Quebrou o streak: reiniciar</span>
    streak <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 3. Atualizar melhor streak</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>streak <span class="token operator">&gt;</span> bestStreak<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    bestStreak <span class="token operator">=</span> streak<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// 4. Verificar conquistas de streak</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>streak <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">unlockAchievement</span><span class="token punctuation">(</span><span class="token string">'streak_7_days'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// +100 créditos</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>streak <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">unlockAchievement</span><span class="token punctuation">(</span><span class="token string">'streak_30_days'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// +500 créditos</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="tela-de-conquistas">7.4 Tela de Conquistas</h3>
<p><strong>UI Proposta:</strong></p>
<pre><code>📊 Suas Conquistas

🔥 Streak Atual: 7 dias
💎 Melhor Streak: 15 dias
🏆 Conquistas: 8/15 desbloqueadas
💰 Créditos Ganhos: 1.325

Conquistas Recentes:
✅ 🔥 Usuário Dedicado (+100 créditos)
✅ 🤝 Primeiro Match (+50 créditos)
✅ 📝 Primeira Demanda (+100 créditos)

Em Progresso:
🔒 Usuário VIP (15/30 dias)
🔒 Desafio: 5 Matches (2/5 matches)
🔒 Profissional (12/50 matches)
</code></pre>
<hr>
<h2 id="fluxo-de-demandas">8. FLUXO DE DEMANDAS</h2>
<h3 id="estados-da-demanda">8.1 Estados da Demanda</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">enum</span> DemandStatus <span class="token punctuation">{</span>
  open<span class="token punctuation">,</span>              <span class="token comment">// Demanda criada, aguardando candidatos</span>
  pendingSelection<span class="token punctuation">,</span>  <span class="token comment">// Tem candidatos, motorista precisa escolher</span>
  matched<span class="token punctuation">,</span>           <span class="token comment">// Match confirmado, aguardando início</span>
  inProgress<span class="token punctuation">,</span>        <span class="token comment">// Serviço iniciado (código validado)</span>
  completed<span class="token punctuation">,</span>         <span class="token comment">// Serviço finalizado, aguardando avaliação</span>
  cancelled          <span class="token comment">// Demanda cancelada</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="estados-da-candidatura">8.2 Estados da Candidatura</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">enum</span> ApplicationStatus <span class="token punctuation">{</span>
  pending<span class="token punctuation">,</span>   <span class="token comment">// Candidatura enviada, aguardando aprovação</span>
  accepted<span class="token punctuation">,</span>  <span class="token comment">// Match confirmado, serviço agendado</span>
  rejected<span class="token punctuation">,</span>  <span class="token comment">// Motorista escolheu outro candidato</span>
  expired    <span class="token comment">// Demanda fechada sem escolha</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="fluxo-completo-happy-path">8.3 Fluxo Completo (Happy Path)</h3>
<h4 id="fase-1-criação-da-demanda-motorista"><strong>FASE 1: Criação da Demanda (Motorista)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Motorista cria demanda</span>
<span class="token function">createDemand</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">"Carga e descarga em São Paulo"</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">"Preciso de ajuda com carga de 15 veículos"</span><span class="token punctuation">,</span>
  location<span class="token punctuation">:</span> <span class="token string">"Terminal ABC, São Paulo - SP"</span><span class="token punctuation">,</span>
  scheduledDate<span class="token punctuation">:</span> <span class="token string">"2026-01-25"</span><span class="token punctuation">,</span>
  scheduledTime<span class="token punctuation">:</span> <span class="token string">"08:00"</span><span class="token punctuation">,</span>
  supportType<span class="token punctuation">:</span> SupportType<span class="token punctuation">.</span>cargaDescarga<span class="token punctuation">,</span>
  offeredValue<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token comment">// créditos que o chapa vai receber</span>
  invitedFavorites<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'chapa1_id'</span><span class="token punctuation">,</span> <span class="token string">'chapa2_id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Opcional</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Sistema:</span>
<span class="token comment">// 1. Debita 50 créditos do motorista</span>
<span class="token comment">// 2. Cria documento em "demands/" com status: open</span>
<span class="token comment">// 3. Envia notificação push para chapas na região (raio configurável)</span>
<span class="token comment">// 4. Envia WhatsApp para chapas favoritos convidados</span>
</code></pre>
<h4 id="fase-2-candidaturas-chapas"><strong>FASE 2: Candidaturas (Chapas)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Chapa se candidata</span>
<span class="token function">applyToDemand</span><span class="token punctuation">(</span>demandId<span class="token punctuation">,</span> chapaId<span class="token punctuation">)</span>

<span class="token comment">// Sistema:</span>
<span class="token comment">// 1. Cria documento em "applications/"</span>
<span class="token comment">// 2. Status da candidatura: pending</span>
<span class="token comment">// 3. Envia notificação WhatsApp para motorista</span>
<span class="token comment">// 4. Atualiza status da demanda para: pendingSelection</span>
</code></pre>
<h4 id="fase-3-seleção-do-chapa-motorista"><strong>FASE 3: Seleção do Chapa (Motorista)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Motorista aceita chapa</span>
<span class="token function">acceptChapa</span><span class="token punctuation">(</span>demandId<span class="token punctuation">,</span> applicationId<span class="token punctuation">,</span> chapaId<span class="token punctuation">)</span>

<span class="token comment">// Sistema:</span>
<span class="token comment">// 1. Reserva 150 créditos do motorista (reserved_balance)</span>
<span class="token comment">// 2. Atualiza status da demanda: matched</span>
<span class="token comment">// 3. Atualiza status da candidatura aceita: accepted</span>
<span class="token comment">// 4. Rejeita outras candidaturas: rejected</span>
<span class="token comment">// 5. Gera códigos:</span>
<span class="token comment">//    - Código do motorista: MMMM (4 dígitos aleatórios)</span>
<span class="token comment">//    - Código do chapa: CCCC (4 dígitos aleatórios)</span>
<span class="token comment">//    - Código completo: MMMM-CCCC</span>
<span class="token comment">// 6. Envia WhatsApp para chapa com código CCCC</span>
<span class="token comment">// 7. Envia WhatsApp para motorista com código MMMM</span>
</code></pre>
<h4 id="fase-4-validação-e-início-no-local-do-serviço"><strong>FASE 4: Validação e Início (No Local do Serviço)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Motorista valida código do chapa (presencial)</span>
<span class="token function">validateChapaCode</span><span class="token punctuation">(</span>serviceCode<span class="token punctuation">,</span> chapaCode<span class="token punctuation">)</span>

<span class="token comment">// Sistema:</span>
<span class="token comment">// 1. Verifica se chapaCode == CCCC armazenado</span>
<span class="token comment">// 2. Se correto:</span>
<span class="token comment">//    - Atualiza status da demanda: inProgress</span>
<span class="token comment">//    - Registra horário de início: started_at</span>
<span class="token comment">//    - Notifica ambas as partes</span>
<span class="token comment">// 3. Se incorreto:</span>
<span class="token comment">//    - Retorna erro: "Código inválido"</span>
</code></pre>
<h4 id="fase-5-conclusão-motorista"><strong>FASE 5: Conclusão (Motorista)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Motorista finaliza serviço</span>
<span class="token function">completeService</span><span class="token punctuation">(</span>serviceId<span class="token punctuation">)</span>

<span class="token comment">// Sistema:</span>
<span class="token comment">// 1. Atualiza status: completed</span>
<span class="token comment">// 2. Registra horário de conclusão: completed_at</span>
<span class="token comment">// 3. Debita 150 créditos reservados do motorista</span>
<span class="token comment">// 4. Credita 500 créditos (offered_value) para o chapa</span>
<span class="token comment">// 5. Solicita avaliação mútua</span>
<span class="token comment">// 6. Notifica ambas as partes</span>
</code></pre>
<h4 id="fase-6-avaliação-mútua"><strong>FASE 6: Avaliação Mútua</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Motorista avalia chapa</span>
<span class="token function">rateChapa</span><span class="token punctuation">(</span>serviceId<span class="token punctuation">,</span> rating<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> review<span class="token punctuation">:</span> <span class="token string">"Excelente profissional!"</span><span class="token punctuation">)</span>

<span class="token comment">// Chapa avalia motorista</span>
<span class="token function">rateMotorista</span><span class="token punctuation">(</span>serviceId<span class="token punctuation">,</span> rating<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> review<span class="token punctuation">:</span> <span class="token string">"Ótimo contratante!"</span><span class="token punctuation">)</span>

<span class="token comment">// Sistema:</span>
<span class="token comment">// 1. Atualiza reputação dos usuários</span>
<span class="token comment">// 2. Calcula média de avaliações</span>
<span class="token comment">// 3. Desbloqueia conquistas (primeira avaliação 5 estrelas)</span>
<span class="token comment">// 4. Marca serviço como totalmente concluído</span>
</code></pre>
<h3 id="fluxo-de-cancelamento">8.4 Fluxo de Cancelamento</h3>
<h4 id="cancelamento-pelo-motorista-após-match"><strong>Cancelamento pelo Motorista (Após Match)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Motorista cancela match</span>
<span class="token function">cancelMatch</span><span class="token punctuation">(</span>applicationId<span class="token punctuation">,</span> reason<span class="token punctuation">,</span> detailedReason<span class="token punctuation">)</span>

<span class="token comment">// Sistema:</span>
<span class="token comment">// 1. Calcula reembolso conforme política de cancelamento</span>
<span class="token comment">// 2. Libera créditos reservados (reembolso parcial/total)</span>
<span class="token comment">// 3. Atualiza status da demanda: open (volta para disponível)</span>
<span class="token comment">// 4. Atualiza status da candidatura: rejected</span>
<span class="token comment">// 5. Registra cancelamento no histórico</span>
<span class="token comment">// 6. Notifica chapa por WhatsApp</span>
</code></pre>
<h4 id="cancelamento-de-candidatura-pelo-chapa-antes-do-match"><strong>Cancelamento de Candidatura (Pelo Chapa, Antes do Match)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Chapa cancela candidatura (antes de ser aceito)</span>
<span class="token function">cancelApplication</span><span class="token punctuation">(</span>applicationId<span class="token punctuation">)</span>

<span class="token comment">// Sistema:</span>
<span class="token comment">// 1. Atualiza status da candidatura: expired</span>
<span class="token comment">// 2. Remove candidatura da lista</span>
<span class="token comment">// 3. Sem penalidades ou taxas</span>
</code></pre>
<hr>
<h2 id="sistema-de-reputação">9. SISTEMA DE REPUTAÇÃO</h2>
<h3 id="cálculo-de-reputação">9.1 Cálculo de Reputação</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">class</span> <span class="token class-name">UserReputation</span> <span class="token punctuation">{</span>
  double reputation<span class="token punctuation">;</span>    <span class="token comment">// 0.0 a 5.0 (média de avaliações)</span>
  int totalRatings<span class="token punctuation">;</span>     <span class="token comment">// Total de avaliações recebidas</span>
<span class="token punctuation">}</span>

<span class="token comment">// Fórmula de cálculo (média simples)</span>
<span class="token function">calculateReputation</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> ratings <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getRatingsForUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ratings<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">// Sem avaliações ainda</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">final</span> sum <span class="token operator">=</span> ratings<span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> a <span class="token operator">+</span> b<span class="token punctuation">.</span>rating<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> average <span class="token operator">=</span> sum <span class="token operator">/</span> ratings<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> average<span class="token punctuation">;</span> <span class="token comment">// Ex: 4.7 estrelas</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="badges-de-reputação">9.2 Badges de Reputação</h3>
<pre class=" language-dart"><code class="prism  language-dart">String <span class="token function">getReputationBadge</span><span class="token punctuation">(</span>double reputation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reputation <span class="token operator">&gt;=</span> <span class="token number">4.8</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'🏆 Elite'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reputation <span class="token operator">&gt;=</span> <span class="token number">4.5</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'⭐ Excelente'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reputation <span class="token operator">&gt;=</span> <span class="token number">4.0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'✅ Bom'</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reputation <span class="token operator">&gt;=</span> <span class="token number">3.5</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">'👍 Regular'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'⚠️ Precisa Melhorar'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="impacto-da-reputação">9.3 Impacto da Reputação</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Alta Reputação (4.5+):</span>
<span class="token comment">// - Aparece no topo da lista de candidatos</span>
<span class="token comment">// - Maior chance de ser aceito em demandas</span>
<span class="token comment">// - Elegível para demandas premium (futuro)</span>
<span class="token comment">// - Badge visível no perfil</span>

<span class="token comment">// Baixa Reputação (&lt;3.5):</span>
<span class="token comment">// - Aparece no final da lista de candidatos</span>
<span class="token comment">// - Alerta para motoristas</span>
<span class="token comment">// - Sugestão de melhoria enviada ao usuário</span>
</code></pre>
<h3 id="sistema-de-avaliação">9.4 Sistema de Avaliação</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Formulário de avaliação</span>
<span class="token punctuation">{</span>
  <span class="token string">"rating"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>                    <span class="token comment">// 1-5 estrelas (obrigatório)</span>
  <span class="token string">"review"</span><span class="token punctuation">:</span> <span class="token string">"Profissional ágil"</span><span class="token punctuation">,</span>  <span class="token comment">// Comentário (opcional)</span>
  <span class="token string">"positive_tags"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>              <span class="token comment">// Tags positivas (opcional)</span>
    <span class="token string">"Pontual"</span><span class="token punctuation">,</span>
    <span class="token string">"Educado"</span><span class="token punctuation">,</span>
    <span class="token string">"Ágil"</span><span class="token punctuation">,</span>
    <span class="token string">"Cuidadoso"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"negative_tags"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>             <span class="token comment">// Tags negativas (opcional)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Armazenamento</span>
services<span class="token operator">/</span><span class="token punctuation">{</span>serviceId<span class="token punctuation">}</span><span class="token operator">/</span>
  <span class="token operator">-</span> motorista_rating<span class="token punctuation">:</span> <span class="token number">5</span>
  <span class="token operator">-</span> motorista_review<span class="token punctuation">:</span> <span class="token string">"Contratante organizado e educado"</span>
  <span class="token operator">-</span> chapa_rating<span class="token punctuation">:</span> <span class="token number">5</span>
  <span class="token operator">-</span> chapa_review<span class="token punctuation">:</span> <span class="token string">"Chapa muito profissional, recomendo!"</span>
  <span class="token operator">-</span> evaluated_at<span class="token punctuation">:</span> timestamp
</code></pre>
<hr>
<h2 id="política-de-privacidade-lgpd">10. POLÍTICA DE PRIVACIDADE (LGPD)</h2>
<h3 id="dados-coletados">10.1 Dados Coletados</h3>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Dados pessoais armazenados</span>
<span class="token punctuation">{</span>
  <span class="token string">"identification"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>           <span class="token comment">// Nome completo</span>
    <span class="token string">"cpf"</span><span class="token punctuation">:</span> <span class="token string">"string (optional)"</span>  <span class="token comment">// CPF (quando necessário para validação)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"contact"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"email"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span>          <span class="token comment">// E-mail</span>
    <span class="token string">"phone"</span><span class="token punctuation">:</span> <span class="token string">"string (optional)"</span><span class="token punctuation">,</span> <span class="token comment">// Telefone</span>
    <span class="token string">"whatsapp_number"</span><span class="token punctuation">:</span> <span class="token string">"string (optional)"</span> <span class="token comment">// WhatsApp</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"location"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"state"</span><span class="token punctuation">:</span> <span class="token string">"string (optional)"</span><span class="token punctuation">,</span> <span class="token comment">// UF</span>
    <span class="token string">"city"</span><span class="token punctuation">:</span> <span class="token string">"string (optional)"</span>   <span class="token comment">// Cidade</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"professional"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"profile"</span><span class="token punctuation">:</span> <span class="token string">"enum"</span><span class="token punctuation">,</span>          <span class="token comment">// Tipo de perfil (motorista/chapa/transportadora)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"referral"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">"referred_by"</span><span class="token punctuation">:</span> <span class="token string">"string (optional)"</span> <span class="token comment">// ID de quem indicou</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="finalidade-do-tratamento">10.2 Finalidade do Tratamento</h3>
<ol>
<li><strong>Validar identidade</strong> e garantir segurança da comunidade</li>
<li><strong>Conectar</strong> motoristas e chapas para serviços</li>
<li><strong>Enviar</strong> comunicações sobre vagas e oportunidades</li>
<li><strong>Melhorar</strong> a experiência e desenvolver funcionalidades</li>
<li><strong>Prevenir</strong> fraudes e abusos do sistema</li>
</ol>
<h3 id="base-legal-lgpd">10.3 Base Legal (LGPD)</h3>
<ul>
<li>✅ <strong>Consentimento:</strong> Aceite de termos ao se cadastrar</li>
<li>✅ <strong>Execução de Contrato:</strong> Viabilizar prestação do serviço</li>
<li>✅ <strong>Legítimo Interesse:</strong> Segurança e prevenção a fraudes</li>
</ul>
<h3 id="direitos-do-titular">10.4 Direitos do Titular</h3>
<p>Os usuários podem solicitar a qualquer momento:</p>
<ul>
<li>✅ Confirmação da existência de tratamento</li>
<li>✅ Acesso aos dados pessoais</li>
<li>✅ Correção de dados incompletos ou desatualizados</li>
<li>✅ Exclusão da conta e dos dados pessoais</li>
</ul>
<p><strong>Canal de Contato:</strong> <a href="mailto:contato@loomper.com.br">contato@loomper.com.br</a></p>
<h3 id="compartilhamento-de-dados">10.5 Compartilhamento de Dados</h3>
<p>❌ <strong>NÃO vendemos dados pessoais</strong></p>
<p>Compartilhamento ocorre apenas:</p>
<ol>
<li>Entre usuários da plataforma (ex: motorista vê perfil do chapa)</li>
<li>Com autoridades competentes (quando exigido por lei)</li>
<li>Com parceiros tecnológicos essenciais (Firebase, SMS Gateway)</li>
</ol>
<h3 id="segurança-e-armazenamento">10.6 Segurança e Armazenamento</h3>
<ul>
<li>🔒 Criptografia de dados em trânsito (HTTPS)</li>
<li>🔒 Servidores Firebase com segurança padrão Google</li>
<li>🔒 Autenticação com Firebase Auth</li>
<li>🔒 Regras de segurança Firestore (validação de acesso)</li>
</ul>
<h3 id="retenção-de-dados">10.7 Retenção de Dados</h3>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Dados são mantidos enquanto a conta estiver ativa</span>
<span class="token comment">// Após exclusão da conta:</span>
retention <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">"immediate_deletion"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"fcm_tokens"</span><span class="token punctuation">,</span>           <span class="token comment">// Tokens de notificação</span>
    <span class="token string">"availability"</span><span class="token punctuation">,</span>         <span class="token comment">// Disponibilidade online/offline</span>
    <span class="token string">"last_access"</span>           <span class="token comment">// Último acesso</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"kept_for_legal_compliance"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"transaction_history"</span><span class="token punctuation">,</span>  <span class="token comment">// Histórico de transações (5 anos)</span>
    <span class="token string">"completed_services"</span><span class="token punctuation">,</span>   <span class="token comment">// Serviços concluídos (5 anos)</span>
    <span class="token string">"ratings_given"</span>         <span class="token comment">// Avaliações dadas (permanente)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string">"anonymized"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">"demands_created"</span><span class="token punctuation">,</span>      <span class="token comment">// Demandas criadas (ID do usuário removido)</span>
    <span class="token string">"applications"</span>          <span class="token comment">// Candidaturas (ID do usuário removido)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="integrações-e-apis">11. INTEGRAÇÕES E APIs</h2>
<h3 id="firebase-services">11.1 Firebase Services</h3>
<h4 id="firebase-authentication"><strong>Firebase Authentication</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Métodos de login implementados</span>
<span class="token operator">-</span> <span class="token function">signInWithEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">signInWithPhone</span><span class="token punctuation">(</span>phoneNumber<span class="token punctuation">,</span> onCodeSent<span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">signInWithGoogle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">verifyOTP</span><span class="token punctuation">(</span>verificationId<span class="token punctuation">,</span> smsCode<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">resetPassword</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="cloud-firestore"><strong>Cloud Firestore</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Collections principais</span>
<span class="token operator">-</span> users<span class="token operator">/</span>
<span class="token operator">-</span> demands<span class="token operator">/</span>
<span class="token operator">-</span> applications<span class="token operator">/</span>
<span class="token operator">-</span> services<span class="token operator">/</span>
<span class="token operator">-</span> referrals<span class="token operator">/</span>
<span class="token operator">-</span> cancellations<span class="token operator">/</span>

<span class="token comment">// Queries comuns</span>
<span class="token operator">-</span> <span class="token function">getUserByEmail</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">getDemandsByLocation</span><span class="token punctuation">(</span>city<span class="token punctuation">,</span> state<span class="token punctuation">,</span> radius<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">getCandidatesForDemand</span><span class="token punctuation">(</span>demandId<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">getUserWallet</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">getCreditTransactions</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
</code></pre>
<h4 id="firebase-cloud-messaging-fcm"><strong>Firebase Cloud Messaging (FCM)</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Notificações push</span>
<span class="token operator">-</span> <span class="token function">onMessageReceived</span><span class="token punctuation">(</span>RemoteMessage message<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">onBackgroundMessage</span><span class="token punctuation">(</span>RemoteMessage message<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> → fcmToken
<span class="token operator">-</span> <span class="token function">subscribeToTopic</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token function">unsubscribeFromTopic</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span>
</code></pre>
<h4 id="firebase-storage"><strong>Firebase Storage</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Upload de fotos de perfil</span>
<span class="token function">uploadProfilePhoto</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> imageFile<span class="token punctuation">)</span> → downloadUrl
<span class="token function">deleteProfilePhoto</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
</code></pre>
<h3 id="whatsapp-business-api">11.2 WhatsApp Business API</h3>
<h4 id="integração-via-whatsapp-business-api"><strong>Integração via WhatsApp Business API</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">class</span> <span class="token class-name">WhatsAppService</span> <span class="token punctuation">{</span>
  <span class="token comment">// Enviar convite de demanda</span>
  <span class="token function">sendDemandInvitation</span><span class="token punctuation">(</span>phoneNumber<span class="token punctuation">,</span> demandTitle<span class="token punctuation">,</span> demandLocation<span class="token punctuation">)</span>
  
  <span class="token comment">// Notificar match confirmado</span>
  <span class="token function">notifyMatchConfirmed</span><span class="token punctuation">(</span>chapaPhone<span class="token punctuation">,</span> demandTitle<span class="token punctuation">,</span> serviceCode<span class="token punctuation">)</span>
  
  <span class="token comment">// Notificar cancelamento</span>
  <span class="token function">notifyCancellation</span><span class="token punctuation">(</span>chapaPhone<span class="token punctuation">,</span> demandTitle<span class="token punctuation">,</span> reason<span class="token punctuation">)</span>
  
  <span class="token comment">// Enviar código de serviço</span>
  <span class="token function">sendServiceCode</span><span class="token punctuation">(</span>chapaPhone<span class="token punctuation">,</span> chapaCode<span class="token punctuation">,</span> serviceDate<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Exemplo de mensagem</span>
<span class="token string">"""
🚛 *Loomper - Nova Demanda!*

📍 Carga e descarga em São Paulo
🕐 Amanhã às 08:00
💰 Pagamento: 500 créditos

Você foi convidado por João Silva (Motorista ⭐ 4.8)

Acesse o app para aceitar: https://app.loomper.com/demands/123
"""</span>
</code></pre>
<h4 id="⚠️-correção-crítica-mensagem-triplicada"><strong>⚠️ CORREÇÃO CRÍTICA: Mensagem Triplicada</strong></h4>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// PROBLEMA IDENTIFICADO (v1.28.0):</span>
<span class="token comment">// WhatsApp sendo enviado 3 vezes após cadastro</span>

<span class="token comment">// SOLUÇÃO:</span>
<span class="token comment">// 1. Verificar se já existe registro de mensagem enviada</span>
<span class="token comment">// 2. Usar flag "whatsapp_sent" no documento de indicação</span>
<span class="token comment">// 3. Adicionar debounce de 5 segundos</span>

Future<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token function">sendReferralWhatsApp</span><span class="token punctuation">(</span>String referredPhone<span class="token punctuation">,</span> String referrerName<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ CORREÇÃO: Verificar se já foi enviado</span>
  <span class="token keyword">final</span> referralDoc <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getReferralByPhone</span><span class="token punctuation">(</span>referredPhone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>referralDoc<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">[</span><span class="token string">'whatsapp_sent'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">debugPrint</span><span class="token punctuation">(</span><span class="token string">'⚠️ WhatsApp já enviado para $referredPhone, ignorando'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Enviar mensagem</span>
  <span class="token keyword">await</span> whatsappAPI<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>referredPhone<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ✅ MARCAR COMO ENVIADO</span>
  <span class="token keyword">await</span> <span class="token function">updateReferralDoc</span><span class="token punctuation">(</span>referralDoc<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">'whatsapp_sent'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string">'whatsapp_sent_at'</span><span class="token punctuation">:</span> FieldValue<span class="token punctuation">.</span><span class="token function">serverTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="ibge-api-localização">11.3 IBGE API (Localização)</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token keyword">class</span> <span class="token class-name">IBGEService</span> <span class="token punctuation">{</span>
  <span class="token comment">// Buscar estados</span>
  Future<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>String<span class="token operator">&gt;&gt;</span> <span class="token function">getStates</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token comment">// Buscar cidades por estado</span>
  Future<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>String<span class="token operator">&gt;&gt;</span> <span class="token function">getCitiesByState</span><span class="token punctuation">(</span>String stateCode<span class="token punctuation">)</span>
  
  <span class="token comment">// Validar cidade e estado</span>
  Future<span class="token operator">&lt;</span>bool<span class="token operator">&gt;</span> <span class="token function">validateLocation</span><span class="token punctuation">(</span>String city<span class="token punctuation">,</span> String state<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="geolocalização-futuro">11.4 Geolocalização (Futuro)</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// Planejado para v2.0</span>
<span class="token keyword">class</span> <span class="token class-name">LocationService</span> <span class="token punctuation">{</span>
  <span class="token comment">// Obter localização atual do usuário</span>
  Future<span class="token operator">&lt;</span>LatLng<span class="token operator">&gt;</span> <span class="token function">getCurrentLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token comment">// Calcular distância entre dois pontos</span>
  double <span class="token function">calculateDistance</span><span class="token punctuation">(</span>LatLng point1<span class="token punctuation">,</span> LatLng point2<span class="token punctuation">)</span>
  
  <span class="token comment">// Buscar demandas próximas (raio em km)</span>
  Future<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>Demand<span class="token operator">&gt;&gt;</span> <span class="token function">getNearbyDemands</span><span class="token punctuation">(</span>LatLng userLocation<span class="token punctuation">,</span> int radiusKm<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="regras-de-negócio-críticas">12. REGRAS DE NEGÓCIO CRÍTICAS</h2>
<h3 id="validações-de-créditos">12.1 Validações de Créditos</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// ✅ ANTES de criar demanda</span>
<span class="token function">validateCreditsForDemandCreation</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> wallet <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getWallet</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>balance <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">InsufficientCreditsException</span><span class="token punctuation">(</span>
      <span class="token string">'Saldo insuficiente. Você precisa de 50 créditos para criar uma demanda.'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ ANTES de aceitar chapa</span>
<span class="token function">validateCreditsForMatchAcceptance</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> wallet <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getWallet</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>wallet<span class="token punctuation">.</span>balance <span class="token operator">&lt;</span> <span class="token number">150</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">InsufficientCreditsException</span><span class="token punctuation">(</span>
      <span class="token string">'Saldo insuficiente. Você precisa de 150 créditos para aceitar um chapa.'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="validações-de-serviço">12.2 Validações de Serviço</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// ✅ Código de serviço precisa ter exatamente 9 caracteres (MMMM-CCCC)</span>
<span class="token function">validateServiceCode</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>code<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">9</span> <span class="token operator">||</span> code<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">InvalidServiceCodeException</span><span class="token punctuation">(</span><span class="token string">'Código inválido. Formato esperado: MMMM-CCCC'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ Chapa só pode validar código no dia e horário do serviço</span>
<span class="token function">validateServiceTiming</span><span class="token punctuation">(</span>scheduledDate<span class="token punctuation">,</span> scheduledTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> serviceDateTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'$scheduledDate $scheduledTime'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> now <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Permitir validação 30 minutos antes do horário agendado</span>
  <span class="token keyword">final</span> allowedStartTime <span class="token operator">=</span> serviceDateTime<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token function">Duration</span><span class="token punctuation">(</span>minutes<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>allowedStartTime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">TooEarlyException</span><span class="token punctuation">(</span>
      <span class="token string">'O serviço está agendado para ${formatDateTime(serviceDateTime)}. '</span>
      <span class="token string">'Você poderá validar o código a partir das ${formatTime(allowedStartTime)}.'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="validações-de-perfil">12.3 Validações de Perfil</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// ✅ Apenas motoristas podem criar demandas</span>
<span class="token function">validateCanCreateDemand</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>profile <span class="token operator">!=</span> UserProfile<span class="token punctuation">.</span>motorista <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span>profile <span class="token operator">!=</span> UserProfile<span class="token punctuation">.</span>transportadora<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">UnauthorizedException</span><span class="token punctuation">(</span>
      <span class="token string">'Apenas motoristas e transportadoras podem criar demandas.'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ Apenas chapas podem se candidatar</span>
<span class="token function">validateCanApplyToDemand</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>profile <span class="token operator">!=</span> UserProfile<span class="token punctuation">.</span>chapa<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">UnauthorizedException</span><span class="token punctuation">(</span>
      <span class="token string">'Apenas chapas podem se candidatar para demandas.'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="anti-fraude">12.4 Anti-Fraude</h3>
<pre class=" language-dart"><code class="prism  language-dart"><span class="token comment">// ✅ Limitar quantidade de demandas por dia</span>
<span class="token keyword">const</span> int maxDemandsPerDay <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token function">validateDailyDemandLimit</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> today <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> todayStart <span class="token operator">=</span> <span class="token function">DateTime</span><span class="token punctuation">(</span>today<span class="token punctuation">.</span>year<span class="token punctuation">,</span> today<span class="token punctuation">.</span>month<span class="token punctuation">,</span> today<span class="token punctuation">.</span>day<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">final</span> demandsToday <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">countDemandsCreatedAfter</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> todayStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>demandsToday <span class="token operator">&gt;=</span> maxDemandsPerDay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">RateLimitException</span><span class="token punctuation">(</span>
      <span class="token string">'Você atingiu o limite de $maxDemandsPerDay demandas por dia. '</span>
      <span class="token string">'Tente novamente amanhã.'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ Limitar quantidade de candidaturas por dia</span>
<span class="token keyword">const</span> int maxApplicationsPerDay <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

<span class="token function">validateDailyApplicationLimit</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> today <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> todayStart <span class="token operator">=</span> <span class="token function">DateTime</span><span class="token punctuation">(</span>today<span class="token punctuation">.</span>year<span class="token punctuation">,</span> today<span class="token punctuation">.</span>month<span class="token punctuation">,</span> today<span class="token punctuation">.</span>day<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">final</span> applicationsToday <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">countApplicationsAfter</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> todayStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>applicationsToday <span class="token operator">&gt;=</span> maxApplicationsPerDay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">RateLimitException</span><span class="token punctuation">(</span>
      <span class="token string">'Você atingiu o limite de $maxApplicationsPerDay candidaturas por dia. '</span>
      <span class="token string">'Tente novamente amanhã.'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ✅ Detectar múltiplos cancelamentos suspeitos</span>
<span class="token keyword">const</span> int maxCancellationsPerMonth <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token function">validateCancellationLimit</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> now <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> firstDayOfMonth <span class="token operator">=</span> <span class="token function">DateTime</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span>year<span class="token punctuation">,</span> now<span class="token punctuation">.</span>month<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">final</span> cancellationsThisMonth <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">countCancellationsSince</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> firstDayOfMonth<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cancellationsThisMonth <span class="token operator">&gt;=</span> maxCancellationsPerMonth<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Notificar equipe de suporte</span>
    <span class="token keyword">await</span> <span class="token function">notifySupportTeam</span><span class="token punctuation">(</span><span class="token string">'Usuário $userId com $cancellationsThisMonth cancelamentos este mês'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">throw</span> <span class="token function">RateLimitException</span><span class="token punctuation">(</span>
      <span class="token string">'Você atingiu o limite de cancelamentos deste mês. '</span>
      <span class="token string">'Contate o suporte: contato@loomper.com.br'</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<hr>
<h2 id="roadmap-de-desenvolvimento">13. ROADMAP DE DESENVOLVIMENTO</h2>
<h3 id="mvp-atual-v1.0---janeiro-2026">13.1 MVP Atual (v1.0 - Janeiro 2026)</h3>
<p>✅ <strong>Implementado:</strong></p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Autenticação (Email, Telefone, Google)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Perfis de usuário (Chapa, Motorista, Transportadora)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Sistema de créditos (renovação mensal, transações)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Criação e gestão de demandas</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Sistema de candidaturas</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Match entre motorista e chapa</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Geração de códigos de serviço (MMMM-CCCC)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Validação presencial com códigos</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Sistema de avaliação mútua</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Reputação (média de avaliações)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Política de cancelamento com reembolso progressivo</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Sistema de favoritos (motorista adiciona chapas)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Sistema de indicações MLM (2 níveis)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Gamificação (conquistas, streaks, badges)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Notificações push (FCM)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Integração WhatsApp Business</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked="true" disabled=""> Política de Privacidade (LGPD)</li>
</ul>
<p>🐛 <strong>Bugs Conhecidos para Correção:</strong></p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> <strong>CRÍTICO:</strong> WhatsApp triplicado após cadastro via indicação</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Link <code>app.loomper</code> não está no landing page próximo ao botão “Baixar APK”</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> APK download link precisa ser atualizado automaticamente quando versão muda</li>
</ul>
<h3 id="v1.1-fevereiro-2026---correções-e-melhorias">13.2 v1.1 (Fevereiro 2026) - Correções e Melhorias</h3>
<p>🎯 <strong>Prioridade Alta:</strong></p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Corrigir envio triplicado de WhatsApp após cadastro</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Adicionar link <code>app.loomper</code> na landing page</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Sincronizar link de download do APK com versões</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Implementar tela de histórico de transações de créditos</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Adicionar filtros avançados na busca de demandas</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Melhorar UX de validação de códigos (QR Code?)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Dashboard de estatísticas para motoristas</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Dashboard de estatísticas para chapas</li>
</ul>
<h3 id="v1.2-março-2026---recursos-avançados">13.3 v1.2 (Março 2026) - Recursos Avançados</h3>
<p>🚀 <strong>Novas Funcionalidades:</strong></p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Chat in-app (Firebase Firestore)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Upload de fotos do serviço (antes/depois)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Geolocalização real-time</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Mapa com demandas próximas</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Sistema de agendamento recorrente</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Pacotes de créditos (compra com dinheiro real)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Gateway de pagamento (Mercado Pago, Stripe)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Ranking de chapas por região</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Certificações e badges especiais</li>
</ul>
<h3 id="v2.0-abril-junho-2026---expansão">13.4 v2.0 (Abril-Junho 2026) - Expansão</h3>
<p>🌐 <strong>Crescimento:</strong></p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> App iOS (Swift/SwiftUI)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Painel administrativo web (Firebase Admin + React)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> API pública para integrações</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Sistema de transportadoras com gestão de frota</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Contratos e SLA para transportadoras</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Integração com TMS (Transport Management System)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Expansão nacional (todas as regiões)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Programa de fidelidade para grandes empresas</li>
</ul>
<h3 id="melhorias-técnicas-contínuas">13.5 Melhorias Técnicas Contínuas</h3>
<p>🔧 <strong>Performance e Qualidade:</strong></p>
<ul>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Testes unitários (80% de cobertura)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Testes de integração (principais fluxos)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> CI/CD (GitHub Actions + Codemagic)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Monitoramento de erros (Sentry ou Firebase Crashlytics)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Analytics (Firebase Analytics + Mixpanel)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Otimização de queries Firestore</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Implementar cache local (Hive)</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Lazy loading de listas longas</li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled=""> Redução de bundle size (code splitting)</li>
</ul>
<hr>
<h2 id="📝-notas-finais-para-o-desenvolvedor">📝 NOTAS FINAIS PARA O DESENVOLVEDOR</h2>
<h3 id="prioridades-de-desenvolvimento">Prioridades de Desenvolvimento</h3>
<ol>
<li><strong>✅ Corrigir bugs críticos</strong> (WhatsApp triplicado, links da landing page)</li>
<li><strong>🎯 Estabilizar MVP</strong> (testes, tratamento de erros, logs)</li>
<li><strong>🚀 Implementar v1.1</strong> (melhorias de UX, dashboards)</li>
<li><strong>🌐 Expansão v2.0</strong> (iOS, painel admin, API pública)</li>
</ol>
<h3 id="contatos-e-suporte">Contatos e Suporte</h3>
<ul>
<li><strong>Email:</strong> <a href="mailto:contato@loomper.com.br">contato@loomper.com.br</a></li>
<li><strong>Empresa:</strong> <a href="http://Ajud.AI">Ajud.AI</a> Tecnologia LTDA</li>
<li><strong>CNPJ:</strong> 59.150.688/0001-39</li>
<li><strong>Endereço:</strong> São Bernardo do Campo - SP</li>
</ul>
<h3 id="tecnologias-recomendadas">Tecnologias Recomendadas</h3>
<pre class=" language-yaml"><code class="prism  language-yaml"><span class="token comment"># Stack Atual (Manter)</span>
<span class="token key atrule">Flutter</span><span class="token punctuation">:</span> 3.35.4
<span class="token key atrule">Dart</span><span class="token punctuation">:</span> 3.9.2
<span class="token key atrule">Firebase</span><span class="token punctuation">:</span> (conforme pubspec.yaml)
<span class="token key atrule">Provider</span><span class="token punctuation">:</span> 6.1.5+1

<span class="token comment"># Próximas Integrações</span>
Payment Gateway<span class="token punctuation">:</span> Mercado Pago SDK
<span class="token key atrule">Maps</span><span class="token punctuation">:</span> Google Maps Flutter
<span class="token key atrule">Chat</span><span class="token punctuation">:</span> Stream Chat Flutter
<span class="token key atrule">Analytics</span><span class="token punctuation">:</span> Mixpanel
<span class="token key atrule">Monitoring</span><span class="token punctuation">:</span> Sentry Flutter
</code></pre>
<h3 id="repositório-e-versionamento">Repositório e Versionamento</h3>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment"># Git Repository Structure</span>
git/
├── main <span class="token punctuation">(</span>production - releases<span class="token punctuation">)</span>
├── develop <span class="token punctuation">(</span>development - features<span class="token punctuation">)</span>
├── feature/* <span class="token punctuation">(</span>feature branches<span class="token punctuation">)</span>
└── hotfix/* <span class="token punctuation">(</span>bug fixes urgentes<span class="token punctuation">)</span>

<span class="token comment"># Conventional Commits</span>
feat: nova funcionalidade
fix: correção de bug
docs: documentação
style: formatação
refactor: refatoração de código
test: testes
chore: tarefas gerais
</code></pre>
<hr>
<h2 id="📊-métricas-de-sucesso-kpis">📊 MÉTRICAS DE SUCESSO (KPIs)</h2>
<h3 id="kpis-de-negócio">KPIs de Negócio</h3>
<ul>
<li><strong>DAU (Daily Active Users):</strong> Usuários ativos por dia</li>
<li><strong>MAU (Monthly Active Users):</strong> Usuários ativos por mês</li>
<li><strong>Retention Rate:</strong> Taxa de retenção (D1, D7, D30)</li>
<li><strong>Match Rate:</strong> % de demandas que geram match</li>
<li><strong>Completion Rate:</strong> % de serviços concluídos</li>
<li><strong>Cancellation Rate:</strong> % de cancelamentos (meta: &lt;10%)</li>
<li><strong>Average Rating:</strong> Média de avaliações (meta: &gt;4.5)</li>
<li><strong>Referral Rate:</strong> Usuários que indicam outros (meta: &gt;30%)</li>
</ul>
<h3 id="kpis-técnicos">KPIs Técnicos</h3>
<ul>
<li><strong>App Crash Rate:</strong> Taxa de crashes (meta: &lt;0.1%)</li>
<li><strong>API Response Time:</strong> Tempo de resposta Firebase (meta: &lt;1s)</li>
<li><strong>App Start Time:</strong> Tempo de inicialização (meta: &lt;3s)</li>
<li><strong>Error Rate:</strong> Taxa de erros (meta: &lt;1%)</li>
<li><strong>Test Coverage:</strong> Cobertura de testes (meta: &gt;80%)</li>
</ul>
<hr>
<p><strong>Documento gerado em:</strong> 22/01/2026<br>
<strong>Versão do Relatório:</strong> 1.0<br>
<strong>Responsável:</strong> Equipe Loomper + AI Assistant<br>
<strong>Próxima Revisão:</strong> Fevereiro 2026</p>
<hr>
<blockquote>
<p>📌 <strong>Este documento contém TODAS as políticas, regras de negócio e especificações técnicas do Loomper MVP v1.0. Compartilhe com desenvolvedores profissionais para continuação do projeto.</strong></p>
</blockquote>
</div>
</body>

</html>
